<!DOCTYPE html>

<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEXUS - Assistente Multiagente</title>

<!-- Carrega o Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Carrega a fonte Inter -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Inter', sans-serif;
    }
    
    #resultado-texto {
        font-family: 'Lora', serif;
    }
    
    #mcp-trace::-webkit-scrollbar {
        width: 8px;
    }
    #mcp-trace::-webkit-scrollbar-track {
        background: #111827;
    }
    #mcp-trace::-webkit-scrollbar-thumb {
        background: #4b5563;
        border-radius: 4px;
    }
    #mcp-trace::-webkit-scrollbar-thumb:hover {
        background: #6b7280;
    }
</style>


</head>

<body class="bg-gray-900 text-gray-200">

<!-- Container principal -->
<div class="flex items-center justify-center min-h-screen p-4">
    
    <!-- Cartão Glassmorphism -->
    <main class="w-full max-w-3xl p-6 md:p-10 bg-gray-800 bg-opacity-70 backdrop-blur-lg border border-gray-700 rounded-xl shadow-2xl transition-all duration-300">
        
        <!-- Cabeçalho -->
        <div class="flex items-center justify-center mb-6">
            <svg class="w-10 h-10 text-blue-400 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M8.25 21v-1.5m1.125-13.875c1.451-1.294 3.057-2.122 4.875-2.122s3.424.828 4.875 2.122m-9.75 0c1.451 1.294 3.057 2.122 4.875 2.122s3.424-.828 4.875-2.122m-9.75 0a3.11 3.11 0 00-4.875 2.122M7.5 12a4.5 4.5 0 011.536-3.375m0 0c1.451-1.294 3.057-2.122 4.875-2.122s3.424.828 4.875 2.122m-9.75 0a3.11 3.11 0 00-4.875 2.122M7.5 12a4.5 4.5 0 011.536-3.375m0 0c1.451 1.294 3.057 2.122 4.875 2.122s3.424.828 4.875 2.122m-9.75 0a3.11 3.11 0 00-4.875 2.122M19.5 8.25h-1.5m-15 0H3m16.5 0a3.11 3.11 0 01-4.875 2.122m0 0a4.5 4.5 0 01-1.536 3.375m0 0a4.5 4.5 0 01-1.536 3.375m0 0a3.11 3.11 0 01-4.875 2.122m0 0c-1.451 1.294-3.057 2.122-4.875 2.122s-3.424-.828-4.875-2.122m9.75 0a4.5 4.5 0 011.536-3.375" />
            </svg>
            <h1 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">NEXUS</h1>
        </div>

        <p class="text-center text-gray-400 text-md mb-8">Assistente de Redação Multiagente</p>

        <!-- Área de Tópicos -->
        <div class="mb-6">
            <label for="topicos-input" class="block text-sm font-medium text-gray-300 mb-2">
                Seus tópicos (um por linha):
            </label>
            <textarea
                id="topicos-input"
                rows="5"
                class="w-full p-4 bg-gray-900 border border-gray-700 rounded-lg text-gray-200 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                placeholder="Ex: Agradecer ao cliente pela parceria&#10;Ex: Agendar reunião de alinhamento&#10;Ex: Solicitar envio do contrato"
            ></textarea>
        </div>

        <!-- Botão -->
        <button id="gerar-btn"
            class="w-full flex items-center justify-center p-3 font-semibold text-lg text-white bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg shadow-lg hover:from-blue-600 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition-all duration-300 disabled:opacity-70 disabled:cursor-not-allowed">

            <svg id="loading-spinner"
                class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden"
                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
            </svg>

            <span id="button-text">Processar Rascunho</span>
        </button>

        <!-- Container de Resultados -->
        <div id="resultado-container" class="mt-8 opacity-0 transition-opacity duration-500">

            <div id="status-msg" class="text-center text-lg font-medium mb-4"></div>

            <div id="output-wrapper" class="hidden">

                <label for="resultado-texto" class="block text-sm font-medium text-gray-300 mb-2">
                    Rascunho Revisado:
                </label>

                <div class="bg-white text-gray-900 rounded-lg p-6 shadow-inner mb-6">
                    <pre id="resultado-texto" class="text-base whitespace-pre-wrap break-words"></pre>
                </div>

                <!-- MCP -->
                <details class="bg-gray-900 bg-opacity-50 border border-gray-700 rounded-lg overflow-hidden">
                    <summary class="p-4 cursor-pointer font-medium text-gray-300 hover:bg-gray-700 transition-colors">
                        Ver Rastreio MCP (Debug)
                    </summary>
                    <div class="p-4 border-t border-gray-700">
                        <pre id="mcp-trace"
                            class="bg-gray-950 text-green-400 font-mono text-sm p-4 rounded-md overflow-x-auto max-h-64">
                        </pre>
                    </div>
                </details>

            </div>
        </div>

    </main>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        
        const gerarBtn = document.getElementById("gerar-btn");
        const topicosInput = document.getElementById("topicos-input");
        const resultadoContainer = document.getElementById("resultado-container");
        const resultadoTexto = document.getElementById("resultado-texto");
        const statusMsg = document.getElementById("status-msg");
        const mcpTrace = document.getElementById("mcp-trace");
        const outputWrapper = document.getElementById("output-wrapper");

        const buttonText = document.getElementById("button-text");
        const loadingSpinner = document.getElementById("loading-spinner");

        const apiUrl = "http://localhost:3000/api/gerar-rascunho";

        const setCarregando = (carregando) => {
            if (carregando) {
                gerarBtn.disabled = true;
                buttonText.textContent = "Processando...";
                loadingSpinner.classList.remove("hidden");

                resultadoContainer.classList.add("opacity-100");
                outputWrapper.classList.add("hidden");

                statusMsg.textContent = "Conectando ao Gateway e Agentes... (pode demorar na 1ª vez)";
                statusMsg.className = "text-center text-lg font-medium mb-4 text-yellow-400";

            } else {
                gerarBtn.disabled = false;
                buttonText.textContent = "Processar Rascunho";
                loadingSpinner.classList.add("hidden");
            }
        };

        const mostrarErro = (mensagem) => {
            statusMsg.textContent = mensagem;
            statusMsg.className = "text-center text-lg font-medium mb-4 text-red-400";
            resultadoContainer.classList.add("opacity-100");
            outputWrapper.classList.add("hidden");
            mcpTrace.closest("details").open = false;
        };

        const mostrarSucesso = (rascunho, mcp) => {
            statusMsg.textContent = "Rascunho gerado e revisado com sucesso!";
            statusMsg.className = "text-center text-lg font-medium mb-4 text-green-400";
            
            resultadoTexto.textContent = rascunho;
            mcpTrace.textContent = JSON.stringify(mcp, null, 2);

            resultadoContainer.classList.add("opacity-100");
            outputWrapper.classList.remove("hidden");
            mcpTrace.closest("details").open = false;
        };

        gerarBtn.addEventListener("click", async () => {

            const topicosTexto = topicosInput.value;

            if (!topicosTexto.trim()) {
                mostrarErro("Por favor, insira pelo menos um tópico.");
                return;
            }

            const topicosArray = topicosTexto
                .split('\n')
                .filter(t => t.trim() !== '');

            if (topicosArray.length === 0) {
                mostrarErro("Por favor, insira tópicos válidos.");
                return;
            }

            setCarregando(true);

            try {
                const response = await fetch(apiUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ topicos: topicosArray })
                });

                const data = await response.json();

                if (!response.ok) {
                    const errorMsg = data.detail || data.error || `Erro HTTP! Status: ${response.status}`;
                    throw new Error(errorMsg);
                }

                mostrarSucesso(data.rascunho_final_revisado, data.mcp_trace);

            } catch (error) {
                console.error("Erro ao chamar API:", error);
                mostrarErro(`Falha na conexão: ${error.message}. Verifique se os containers estão rodando.`);
            } finally {
                gerarBtn.disabled = false;
                buttonText.textContent = "Processar Rascunho";
                loadingSpinner.classList.add("hidden");
            }
        });
    });
</script>


</body>
</html>